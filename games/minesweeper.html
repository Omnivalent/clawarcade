<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Neon Minesweeper</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100dvh;overflow:hidden;background:#0a0a1a;color:#fff;font-family:'Segoe UI',sans-serif;touch-action:none;user-select:none}
#app{display:flex;flex-direction:column;height:100dvh}
#top{height:36px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:#0d0d2b;border-bottom:1px solid #1a1a3a;font-size:14px}
.title{color:#0ff;text-shadow:0 0 8px #0ff;animation:neonPulse 2s ease-in-out infinite}
@keyframes neonPulse{0%,100%{text-shadow:0 0 8px #0ff}50%{text-shadow:0 0 15px #0ff,0 0 25px #0ff}}
.info span{margin:0 6px;font-size:13px;transition:transform 0.2s}
.info span.pop{transform:scale(1.2)}
.mines{color:#f44;text-shadow:0 0 6px #f44}
.timer{color:#0f0;text-shadow:0 0 6px #0f0}
#grid-wrap{flex:1;display:flex;align-items:center;justify-content:center;overflow:hidden;padding:4px;position:relative;transition:transform 0.05s}
#grid-wrap.shake{animation:shake 0.4s ease-out}
@keyframes shake{0%,100%{transform:translate(0,0)}10%{transform:translate(-8px,4px)}20%{transform:translate(8px,-4px)}30%{transform:translate(-6px,6px)}40%{transform:translate(6px,-6px)}50%{transform:translate(-4px,4px)}60%{transform:translate(4px,-4px)}70%{transform:translate(-2px,2px)}80%{transform:translate(2px,-2px)}90%{transform:translate(-1px,1px)}}
#grid{display:inline-grid;gap:2px;border:2px solid #0ff;border-radius:4px;padding:2px;box-shadow:0 0 20px rgba(0,255,255,0.2),inset 0 0 15px rgba(0,255,255,0.05);transition:box-shadow 0.3s,border-color 0.3s}
.cell{display:flex;align-items:center;justify-content:center;border-radius:3px;font-weight:bold;font-size:14px;cursor:pointer;transition:all 0.15s ease}
.cell.hidden{background:#1a1a3a;border:1px solid #2a2a5a}
.cell.hidden:active{background:#2a2a5a;transform:scale(0.95)}
.cell.revealed{background:#0d0d20;border:1px solid #1a1a3a;animation:revealPop 0.2s ease-out}
@keyframes revealPop{0%{transform:scale(0.8);opacity:0.5}100%{transform:scale(1);opacity:1}}
.cell.flagged{background:#1a1a3a;border:1px solid #f44;animation:flagPop 0.2s ease-out}
@keyframes flagPop{0%{transform:scale(0.8)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
.cell.mine{background:#400;border:1px solid #f44;animation:explode 0.3s ease-out}
@keyframes explode{0%{transform:scale(0.5);background:#f00}50%{transform:scale(1.2);background:#f44}100%{transform:scale(1);background:#400}}
.n1{color:#0ff;text-shadow:0 0 6px #0ff}
.n2{color:#0f0;text-shadow:0 0 6px #0f0}
.n3{color:#f44;text-shadow:0 0 6px #f44}
.n4{color:#44f;text-shadow:0 0 6px #44f}
.n5{color:#f80;text-shadow:0 0 6px #f80}
.n6{color:#0ff;text-shadow:0 0 6px #0ff}
.n7{color:#f0f;text-shadow:0 0 6px #f0f}
.n8{color:#fff;text-shadow:0 0 6px #fff}
#controls{height:80px;display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap;background:#0d0d2b;border-top:1px solid #1a1a3a;padding:4px}
#controls button{min-width:44px;min-height:44px;padding:6px 12px;border:1px solid #0ff;background:transparent;color:#0ff;border-radius:8px;font-size:13px;cursor:pointer;transition:all 0.2s}
#controls button:active,#controls button.active{background:#0ff3;transform:scale(0.95)}
#overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#0a0a1aee;z-index:10;animation:fadeIn 0.3s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
#overlay.hidden{display:none}
#overlay h2{color:#0ff;text-shadow:0 0 12px #0ff,0 0 30px #0ff;font-size:24px;margin-bottom:16px;animation:neonPulse 2s ease-in-out infinite}
#overlay .diffs{display:flex;gap:10px;margin-bottom:16px}
#overlay .diffs button{min-height:44px;padding:10px 18px;border:2px solid #0ff;background:transparent;color:#0ff;border-radius:8px;font-size:14px;cursor:pointer;transition:all 0.2s}
#overlay .diffs button:active{background:#0ff2;transform:scale(0.95)}
#overlay p{color:#aaa;font-size:13px;text-align:center;padding:0 20px}
#particles{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.particle{position:absolute;border-radius:50%;pointer-events:none;animation:particleFade 0.8s ease-out forwards}
@keyframes particleFade{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0)}}
</style>
</head>
<body>
<div id="app">
<div id="top">
<span class="title">üí£ MINESWEEPER</span>
<div class="info"><span class="mines" id="mc">üí£ 10</span><span class="timer" id="tm">‚è± 0s</span></div>
</div>
<div id="grid-wrap">
    <div id="grid"></div>
    <div id="particles"></div>
</div>
<div id="controls">
<button id="btnFlag">üö© Flag</button>
<button id="btnNew">üîÑ New</button>
<button id="btnMute">üîä</button>
</div>
</div>
<div id="overlay">
<h2>üí£ NEON MINESWEEPER</h2>
<p style="margin-bottom:12px">Tap to reveal ¬∑ Long-press or Flag mode to flag</p>
<div class="diffs">
<button onclick="startGame(8,8,10)">Easy</button>
<button onclick="startGame(12,12,30)">Medium</button>
<button onclick="startGame(16,16,60)">Hard</button>
</div>
<p id="endMsg"></p>
</div>
<script>
// === WEB AUDIO API SOUND SYSTEM ===
let audioCtx = null;
let soundEnabled = true;
let audioInitialized = false;

function initAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
    audioInitialized = true;
}

// Initialize audio on FIRST user interaction
function initAudioOnce() {
    if (!audioInitialized) initAudio();
}
document.addEventListener('click', initAudioOnce, { once: true });
document.addEventListener('touchstart', initAudioOnce, { once: true });

function playTone(freq, type, duration, vol = 0.2) {
    if (!soundEnabled || !audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(vol, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
}

function playReveal() { playTone(300, 'sine', 0.05, 0.1); }
function playFlag() { playTone(500, 'sine', 0.08, 0.15); }
function playUnflag() { playTone(350, 'sine', 0.06, 0.1); }
function playNumber(n) { playTone(300 + n * 50, 'sine', 0.08, 0.15); }
function playExplosion() {
    playTone(100, 'sawtooth', 0.3, 0.3);
    setTimeout(() => playTone(60, 'sawtooth', 0.4, 0.25), 100);
    setTimeout(() => playTone(40, 'sawtooth', 0.5, 0.2), 200);
}
function playWin() {
    [523, 659, 784, 1047].forEach((f, i) => setTimeout(() => playTone(f, 'sine', 0.2, 0.25), i * 100));
}
function playClick() { playTone(600, 'sine', 0.05, 0.1); }

document.getElementById('btnMute').onclick = () => {
    initAudio();
    soundEnabled = !soundEnabled;
    document.getElementById('btnMute').textContent = soundEnabled ? 'üîä' : 'üîá';
    playClick();
};

const gridEl=document.getElementById('grid'),overlay=document.getElementById('overlay');
const mcEl=document.getElementById('mc'),tmEl=document.getElementById('tm'),endMsg=document.getElementById('endMsg');
const btnFlag=document.getElementById('btnFlag');
const particlesEl=document.getElementById('particles');
const gridWrap=document.getElementById('grid-wrap');
let rows,cols,mines,board,revealed,flagged,gameOver,firstClick,timer,seconds,flagMode=false;
let borderPhase=0;
let animFrame=null;

btnFlag.onclick=()=>{
    initAudio();playClick();
    flagMode=!flagMode;
    btnFlag.classList.toggle('active',flagMode);
};
document.getElementById('btnNew').onclick=()=>{
    playClick();
    clearInterval(timer);
    if(animFrame){cancelAnimationFrame(animFrame);animFrame=null;}
    overlay.classList.remove('hidden');
    endMsg.textContent='';
};

function addParticle(x,y,color){
    const el=document.createElement('div');
    el.className='particle';
    el.style.left=(x+Math.random()*20-10)+'px';
    el.style.top=(y+Math.random()*20-10)+'px';
    el.style.width=el.style.height=(4+Math.random()*6)+'px';
    el.style.background=color;
    el.style.boxShadow='0 0 6px '+color;
    particlesEl.appendChild(el);
    setTimeout(()=>el.remove(),800);
}

function addExplosionParticles(x,y){
    for(let i=0;i<20;i++){
        const el=document.createElement('div');
        el.className='particle';
        const angle=Math.random()*Math.PI*2;
        const dist=20+Math.random()*40;
        el.style.left=(x+Math.cos(angle)*dist)+'px';
        el.style.top=(y+Math.sin(angle)*dist)+'px';
        el.style.width=el.style.height=(4+Math.random()*8)+'px';
        el.style.background=Math.random()>0.5?'#f44':'#ff0';
        el.style.boxShadow='0 0 8px #f44';
        particlesEl.appendChild(el);
        setTimeout(()=>el.remove(),800);
    }
}

function triggerShake(){
    gridWrap.classList.remove('shake');
    void gridWrap.offsetWidth;
    gridWrap.classList.add('shake');
}

function popMineCount(){
    mcEl.classList.add('pop');
    setTimeout(()=>mcEl.classList.remove('pop'),200);
}

window.startGame=function(r,c,m){
    initAudio();playClick();
    rows=r;cols=c;mines=m;
    board=[];revealed=[];flagged=[];gameOver=false;firstClick=true;seconds=0;
    clearInterval(timer);
    if(animFrame){cancelAnimationFrame(animFrame);animFrame=null;}
    tmEl.textContent='‚è± 0s';
    for(let i=0;i<rows;i++){board[i]=[];revealed[i]=[];flagged[i]=[];for(let j=0;j<cols;j++){board[i][j]=0;revealed[i][j]=false;flagged[i][j]=false;}}
    overlay.classList.add('hidden');
    particlesEl.innerHTML='';
    updateMineCount();
    renderGrid();
    animFrame=requestAnimationFrame(animLoop);
};

function animLoop(){
    borderPhase+=0.03;
    const glow=12+Math.sin(borderPhase)*8;
    gridEl.style.boxShadow=`0 0 ${glow}px rgba(0,255,255,${0.2+Math.sin(borderPhase)*0.1}),inset 0 0 ${glow}px rgba(0,255,255,0.05)`;
    if(!gameOver)animFrame=requestAnimationFrame(animLoop);
}

function placeMines(sr,sc){
    let placed=0;
    while(placed<mines){
        const r=Math.floor(Math.random()*rows),c=Math.floor(Math.random()*cols);
        if(board[r][c]===-1)continue;
        if(Math.abs(r-sr)<=1&&Math.abs(c-sc)<=1)continue;
        board[r][c]=-1;placed++;
        for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){
            const nr=r+dr,nc=c+dc;
            if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&board[nr][nc]!==-1)board[nr][nc]++;
        }
    }
}

function renderGrid(){
    const wrap=document.getElementById('grid-wrap');
    const maxW=wrap.clientWidth-12,maxH=wrap.clientHeight-12;
    const cellSize=Math.min(Math.floor(maxW/cols),Math.floor(maxH/rows),44);
    gridEl.style.gridTemplateColumns=`repeat(${cols},${cellSize}px)`;
    gridEl.style.gridTemplateRows=`repeat(${rows},${cellSize}px)`;
    gridEl.innerHTML='';
    for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
        const cell=document.createElement('div');
        cell.className='cell hidden';
        cell.dataset.r=r;cell.dataset.c=c;
        cell.style.fontSize=Math.max(10,cellSize*0.45)+'px';
        let longTimer;
        cell.addEventListener('touchstart',e=>{e.preventDefault();longTimer=setTimeout(()=>{toggleFlag(r,c);longTimer=null;},400);},{passive:false});
        cell.addEventListener('touchend',e=>{e.preventDefault();if(longTimer){clearTimeout(longTimer);if(flagMode)toggleFlag(r,c);else reveal(r,c);}},{passive:false});
        cell.addEventListener('touchmove',()=>{clearTimeout(longTimer);longTimer=null;});
        cell.addEventListener('click',e=>{if(flagMode)toggleFlag(r,c);else reveal(r,c);});
        cell.addEventListener('contextmenu',e=>{e.preventDefault();toggleFlag(r,c);});
        gridEl.appendChild(cell);
    }
}

function getCell(r,c){return gridEl.children[r*cols+c];}

function updateMineCount(){
    const f=flagged.flat().filter(Boolean).length;
    mcEl.textContent='üí£ '+(mines-f);
}

function toggleFlag(r,c){
    if(gameOver||revealed[r][c])return;
    const wasFlag=flagged[r][c];
    flagged[r][c]=!flagged[r][c];
    if(flagged[r][c])playFlag();else playUnflag();
    const cell=getCell(r,c);
    cell.classList.toggle('flagged',flagged[r][c]);
    cell.classList.toggle('hidden',!flagged[r][c]);
    cell.textContent=flagged[r][c]?'üö©':'';
    updateMineCount();popMineCount();
    
    const rect=cell.getBoundingClientRect();
    const wrapRect=gridWrap.getBoundingClientRect();
    if(flagged[r][c]){
        addParticle(rect.left-wrapRect.left+rect.width/2,rect.top-wrapRect.top+rect.height/2,'#f44');
    }
}

function reveal(r,c){
    if(gameOver||flagged[r][c]||revealed[r][c])return;
    if(firstClick){
        firstClick=false;
        placeMines(r,c);
        timer=setInterval(()=>{seconds++;tmEl.textContent='‚è± '+seconds+'s';},1000);
    }
    revealed[r][c]=true;
    const cell=getCell(r,c);
    cell.classList.remove('hidden','flagged');
    cell.classList.add('revealed');
    
    const rect=cell.getBoundingClientRect();
    const wrapRect=gridWrap.getBoundingClientRect();
    
    if(board[r][c]===-1){
        cell.classList.add('mine');cell.textContent='üí•';
        gameOver=true;clearInterval(timer);
        playExplosion();
        triggerShake();
        addExplosionParticles(rect.left-wrapRect.left+rect.width/2,rect.top-wrapRect.top+rect.height/2);
        revealAll();
        setTimeout(()=>{overlay.classList.remove('hidden');endMsg.textContent='üí• Game Over! Time: '+seconds+'s';},500);
        return;
    }
    
    if(board[r][c]>0){
        cell.textContent=board[r][c];cell.classList.add('n'+board[r][c]);
        playNumber(board[r][c]);
        for(let i=0;i<board[r][c];i++){
            addParticle(rect.left-wrapRect.left+rect.width/2,rect.top-wrapRect.top+rect.height/2,'#0ff');
        }
    }else{
        playReveal();
        for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){
            const nr=r+dr,nc=c+dc;
            if(nr>=0&&nr<rows&&nc>=0&&nc<cols)reveal(nr,nc);
        }
    }
    checkWin();
}

function checkWin(){
    let unrevealed=0;
    for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)if(!revealed[r][c])unrevealed++;
    if(unrevealed===mines){
        gameOver=true;clearInterval(timer);
        playWin();
        setTimeout(()=>{overlay.classList.remove('hidden');endMsg.textContent='üéâ You Win! Time: '+seconds+'s';},300);
    }
}

function revealAll(){
    for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
        if(board[r][c]===-1&&!revealed[r][c]){
            const cell=getCell(r,c);cell.classList.remove('hidden');cell.classList.add('mine');cell.textContent='üí£';
        }
    }
}
</script>
</body>
</html>
