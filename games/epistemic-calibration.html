<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Epistemic Calibration</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#1a1a2e;color:#e0e0e0;font-family:'Segoe UI',system-ui,sans-serif;height:100dvh;overflow:hidden;display:flex;flex-direction:column;align-items:center;padding:12px}
h1{color:#00d4aa;font-size:1.4em;margin:8px 0}
.sub{color:#888;font-size:.85em;margin-bottom:12px}
#game{width:100%;max-width:500px;flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch}
.card{background:#16213e;border-radius:12px;padding:16px;margin:8px 0;border:1px solid #0f3460}
.question{font-size:1.05em;line-height:1.5;margin:8px 0;font-weight:500}
.btn{background:#00d4aa;color:#1a1a2e;border:none;border-radius:10px;padding:14px 20px;font-size:1em;font-weight:700;cursor:pointer;width:100%;margin:6px 0;transition:all .15s;-webkit-tap-highlight-color:transparent}
.btn:active{transform:scale(.96)}
.btn.opt{background:#16213e;color:#e0e0e0;border:2px solid #0f3460;text-align:left;font-weight:400}
.btn.opt.selected{border-color:#00d4aa;background:#0f3460}
.btn.correct{background:#00b894!important;color:#fff!important;border-color:#00b894!important}
.btn.wrong{background:#e74c3c!important;color:#fff!important;border-color:#e74c3c!important}
.hud{display:flex;justify-content:space-between;padding:8px 0;font-size:.9em;color:#00d4aa}
.confidence{margin:12px 0}
.conf-label{display:flex;justify-content:space-between;font-size:.8em;color:#888;margin-bottom:4px}
.slider-wrap{position:relative;padding:8px 0}
input[type=range]{-webkit-appearance:none;width:100%;height:8px;border-radius:4px;background:linear-gradient(90deg,#e74c3c,#f39c12,#00b894);outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;border-radius:50%;background:#fff;border:3px solid #00d4aa;cursor:pointer}
.conf-val{text-align:center;font-size:1.4em;font-weight:700;color:#00d4aa;margin:4px 0}
.center{text-align:center}
.fade{animation:fadeIn .3s}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1}}
.big{font-size:2em;margin:12px 0}
.cal-chart{margin:12px 0}
.cal-row{display:flex;align-items:center;gap:8px;margin:4px 0;font-size:.85em}
.cal-bar-bg{flex:1;height:12px;background:#0f3460;border-radius:6px;overflow:hidden;position:relative}
.cal-bar{height:100%;border-radius:6px;transition:width .5s}
.cal-ideal{position:absolute;height:100%;border-right:2px dashed #fff;top:0}
.explain{background:#0f3460;border-radius:8px;padding:12px;margin-top:10px;font-size:.85em;line-height:1.4;color:#aaa}
</style>
</head>
<body>
<h1>üéØ Epistemic Calibration</h1>
<p class="sub">Answer + rate your confidence</p>
<div id="game"></div>
<script>
const questions=[
{q:"What is the approximate speed of light?",opts:["300,000 km/s","150,000 km/s","500,000 km/s","1,000,000 km/s"],a:0},
{q:"Which planet has the most moons in our solar system?",opts:["Jupiter","Saturn","Uranus","Neptune"],a:1},
{q:"In what year was the first iPhone released?",opts:["2005","2006","2007","2008"],a:2},
{q:"What is the chemical symbol for tungsten?",opts:["Tu","Tg","W","Wn"],a:2},
{q:"Which country has the longest coastline?",opts:["Russia","Indonesia","Canada","Australia"],a:2},
{q:"What percentage of Earth's water is freshwater?",opts:["About 3%","About 10%","About 25%","About 50%"],a:0},
{q:"Who painted 'The Persistence of Memory' (melting clocks)?",opts:["Picasso","Dal√≠","Magritte","Warhol"],a:1},
{q:"What is the smallest bone in the human body?",opts:["Stapes (ear)","Phalanx (toe)","Hyoid (throat)","Coccyx (tailbone)"],a:0},
{q:"Which element has the highest melting point?",opts:["Iron","Tungsten","Carbon","Titanium"],a:2},
{q:"In computing, how many bytes are in a kibibyte (KiB)?",opts:["1000","1012","1024","1048"],a:2},
{q:"What is the deepest point in Earth's oceans?",opts:["Mariana Trench","Tonga Trench","Philippine Trench","Puerto Rico Trench"],a:0},
{q:"Which programming language was created first?",opts:["C","FORTRAN","COBOL","Pascal"],a:1},
{q:"What is the half-life of Carbon-14?",opts:["~1,400 years","~5,730 years","~14,000 years","~57,300 years"],a:1},
{q:"How many time zones does Russia span?",opts:["7","9","11","13"],a:2},
{q:"What year did the Berlin Wall fall?",opts:["1987","1988","1989","1990"],a:2}
];

let order=[],idx=0,answers=[];// {correct,confidence}
const G=document.getElementById('game');

function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.random()*i+1|0;[a[i],a[j]]=[a[j],a[i]]}return a}

function start(){
order=shuffle([...Array(questions.length).keys()]);
idx=0;answers=[];
showQ();
}

let selectedOpt=-1,confidence=50;

function showQ(){
if(idx>=order.length){showResults();return}
selectedOpt=-1;confidence=50;
const q=questions[order[idx]];
let optsHtml=q.opts.map((o,i)=>`<button class="btn opt" onclick="selOpt(${i})" id="o${i}">${o}</button>`).join('');
G.innerHTML=`<div class="hud"><span>${idx+1}/${order.length}</span><span>Answered: ${answers.length}</span></div>
<div class="card fade">
<p class="question">${q.q}</p>
${optsHtml}
<div class="confidence" id="confSection" style="display:none">
<p style="font-weight:700;margin-bottom:4px">How confident are you?</p>
<div class="conf-label"><span>Guessing</span><span>Certain</span></div>
<div class="slider-wrap"><input type="range" min="25" max="100" value="50" step="5" id="confSlider" oninput="updConf()"></div>
<div class="conf-val" id="confVal">50%</div>
<button class="btn" onclick="submit_()">Lock In Answer</button>
</div>
</div>`;
}

function selOpt(i){
selectedOpt=i;
document.querySelectorAll('.btn.opt').forEach((b,j)=>b.classList.toggle('selected',j===i));
document.getElementById('confSection').style.display='block';
}

function updConf(){
confidence=parseInt(document.getElementById('confSlider').value);
document.getElementById('confVal').textContent=confidence+'%';
}

function submit_(){
const q=questions[order[idx]];
const correct=selectedOpt===q.a;
answers.push({correct,confidence});
document.getElementById('o'+q.a).classList.add('correct');
if(!correct)document.getElementById('o'+selectedOpt).classList.add('wrong');
document.getElementById('confSection').innerHTML=`<div class="explain">${correct?'‚úÖ Correct!':'‚ùå Wrong!'} You were ${confidence}% confident.</div>`;
setTimeout(()=>{idx++;showQ()},1200);
}

function showResults(){
const totalCorrect=answers.filter(a=>a.correct).length;
// Calculate calibration: group by confidence buckets
const buckets={};
answers.forEach(a=>{
const b=Math.round(a.confidence/20)*20; // 20,40,60,80,100
if(!buckets[b])buckets[b]={total:0,correct:0,conf:b};
buckets[b].total++;
if(a.correct)buckets[b].correct++;
});

let calError=0,calCount=0;
const sortedBuckets=Object.values(buckets).sort((a,b)=>a.conf-b.conf);
sortedBuckets.forEach(b=>{
const actual=b.correct/b.total*100;
calError+=Math.abs(actual-b.conf);
calCount++;
});
const avgCalError=calCount>0?Math.round(calError/calCount):0;
const calScore=Math.max(0,100-avgCalError);

let chartHtml=sortedBuckets.map(b=>{
const actual=Math.round(b.correct/b.total*100);
const color=Math.abs(actual-b.conf)<=15?'#00b894':Math.abs(actual-b.conf)<=30?'#f39c12':'#e74c3c';
return `<div class="cal-row"><span style="min-width:40px">${b.conf}%</span><div class="cal-bar-bg"><div class="cal-bar" style="width:${actual}%;background:${color}"></div><div class="cal-ideal" style="left:${b.conf}%"></div></div><span style="min-width:60px">${actual}% (${b.correct}/${b.total})</span></div>`;
}).join('');

let grade=calScore>=80?'üèÜ Perfectly Calibrated':calScore>=60?'üéØ Well Calibrated':calScore>=40?'üìä Somewhat Calibrated':'ü´† Needs Calibration';

G.innerHTML=`<div class="card center fade">
<div class="big">üéØ</div>
<p style="font-size:1.3em;font-weight:700;color:#00d4aa">${grade}</p>
<p style="font-size:1.5em;font-weight:700;margin:8px 0">${totalCorrect}/${answers.length} correct</p>
<p style="color:#888">Calibration Score: <strong style="color:#00d4aa">${calScore}%</strong></p>
<p style="color:#666;font-size:.8em">Lower bar-to-line gap = better calibrated</p>
</div>
<div class="card fade">
<p style="font-weight:700;margin-bottom:8px">Calibration Chart</p>
<p style="font-size:.8em;color:#888;margin-bottom:8px">Bar = actual accuracy | Dashed line = your confidence</p>
<div class="cal-chart">${chartHtml}</div>
</div>
<button class="btn" onclick="start()">Play Again</button>`;
}

G.innerHTML=`<div class="card center fade">
<div class="big">üéØ</div>
<p style="margin:8px 0">Answer trivia questions <strong>AND</strong> rate how confident you are.</p>
<p style="color:#888;font-size:.9em">Your score is based on <strong style="color:#00d4aa">calibration</strong> ‚Äî how well your confidence matches your actual accuracy.</p>
<p style="color:#00d4aa;margin:8px 0">${questions.length} questions</p>
<button class="btn" onclick="start()">Start</button>
</div>`;
</script>
</body>
</html>