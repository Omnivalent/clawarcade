<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Verbal Fluency Test - ClawMD</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: linear-gradient(135deg, #1a2332 0%, #0f1419 100%); 
            color: #e8e6e3; 
            min-height: 100vh; 
            padding: 1rem;
        }
        .container { max-width: 600px; margin: 0 auto; }
        
        .header { text-align: center; margin-bottom: 1.5rem; padding: 1.5rem; background: rgba(139, 0, 0, 0.2); border-radius: 12px; border: 2px solid #C5A572; }
        .header h1 { color: #C5A572; font-size: 1.8rem; margin-bottom: 0.5rem; }
        .header p { color: #aaa; font-size: 1rem; }
        
        .disclaimer { 
            background: rgba(255, 193, 7, 0.15); 
            border: 2px solid #ffc107; 
            border-radius: 10px; 
            padding: 1rem; 
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
        }
        .disclaimer strong { color: #ffc107; }
        
        .card { 
            background: rgba(0, 33, 71, 0.4); 
            border: 2px solid #C5A572; 
            border-radius: 12px; 
            padding: 1.5rem; 
            margin-bottom: 1rem;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .tab {
            padding: 0.75rem 1.5rem;
            background: #1a2332;
            border: 2px solid #C5A572;
            color: #C5A572;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .tab:hover { background: rgba(197, 165, 114, 0.2); }
        .tab.active { background: #C5A572; color: #1a1a2e; }
        
        .instructions {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .instructions h2 { color: #C5A572; margin-bottom: 1rem; }
        .instructions p { font-size: 1.1rem; line-height: 1.6; }
        
        .category-display {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: #1a1a2e;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 1.5rem 0;
        }
        
        .timer-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(#00d4aa var(--progress, 100%), #2a3441 0);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1.5rem auto;
            position: relative;
        }
        .timer-inner {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #1a2332;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .timer-number { font-size: 2.5rem; font-weight: bold; color: #00d4aa; }
        .timer-label { font-size: 0.9rem; color: #888; }
        
        .input-area {
            margin: 1.5rem 0;
        }
        .word-input {
            width: 100%;
            padding: 1rem;
            font-size: 1.3rem;
            border: 3px solid #C5A572;
            border-radius: 10px;
            background: #1a2332;
            color: #e8e6e3;
            text-align: center;
        }
        .word-input:focus { outline: none; border-color: #00d4aa; }
        .word-input:disabled { opacity: 0.5; }
        
        .word-count {
            font-size: 3rem;
            font-weight: bold;
            color: #00d4aa;
            text-align: center;
            margin: 1rem 0;
        }
        .word-count-label { font-size: 1rem; color: #C5A572; }
        
        .words-list {
            background: #1a2332;
            border-radius: 10px;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            margin: 1rem 0;
        }
        .word-chip {
            display: inline-block;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            margin: 0.25rem;
            font-size: 0.95rem;
        }
        .word-chip.duplicate { background: rgba(231, 76, 60, 0.2); border-color: #e74c3c; color: #e74c3c; }
        .word-chip.invalid { background: rgba(255, 193, 7, 0.2); border-color: #ffc107; color: #ffc107; }
        
        .btn { 
            background: linear-gradient(135deg, #8B0000 0%, #6B0000 100%); 
            color: #C5A572; 
            border: 2px solid #C5A572;
            padding: 1rem 2rem; 
            font-size: 1.1rem; 
            font-weight: 600;
            border-radius: 8px; 
            cursor: pointer; 
            min-height: 56px;
            transition: all 0.3s;
            margin: 0.5rem;
        }
        .btn:hover { background: linear-gradient(135deg, #A00000 0%, #8B0000 100%); }
        .btn.secondary { background: #2a3441; }
        
        .score-display { 
            text-align: center;
            padding: 2rem; 
            background: rgba(0, 212, 170, 0.1); 
            border-radius: 12px; 
            margin: 1.5rem 0;
        }
        .score-big { font-size: 4rem; color: #00d4aa; font-weight: bold; }
        .score-label { font-size: 1.2rem; color: #C5A572; }
        
        .norms-info {
            background: #1a2332;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .norms-info h4 { color: #C5A572; margin-bottom: 0.75rem; }
        .norms-info ul { margin-left: 1.5rem; line-height: 1.8; }
        .norm-good { color: #00d4aa; }
        .norm-avg { color: #ffc107; }
        .norm-concern { color: #e74c3c; }
        
        .interpretation { 
            padding: 1.5rem; 
            border-radius: 10px; 
            margin: 1rem 0;
            line-height: 1.6;
        }
        .interp-good { background: rgba(0, 212, 170, 0.2); border: 2px solid #00d4aa; }
        .interp-concern { background: rgba(255, 193, 7, 0.2); border: 2px solid #ffc107; }
        .interp-alert { background: rgba(244, 67, 54, 0.2); border: 2px solid #f44336; }
        
        .history-section { margin-top: 2rem; }
        .history-title { color: #C5A572; font-size: 1.2rem; margin-bottom: 1rem; text-align: center; }
        .history-list { background: #1a2332; border-radius: 8px; max-height: 200px; overflow-y: auto; }
        .history-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #2a3441;
        }
        
        .back-link { 
            display: inline-block; 
            color: #C5A572; 
            text-decoration: none; 
            margin-bottom: 1rem;
        }
        .back-link:hover { text-decoration: underline; }
        
        .hidden { display: none !important; }
        
        .feedback {
            text-align: center;
            font-size: 1.1rem;
            margin: 0.5rem 0;
            min-height: 1.5em;
        }
        .feedback.success { color: #00d4aa; }
        .feedback.error { color: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../games.html" class="back-link">‚Üê Back to Games</a>
        
        <div class="header">
            <h1>üí¨ Verbal Fluency Test</h1>
            <p>Category & Letter Fluency Assessment</p>
        </div>
        
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Note:</strong> Verbal fluency tests are validated clinical assessments. 
            Results may vary based on education and language background.
        </div>
        
        <!-- Test Selection -->
        <div class="card" id="selectionCard">
            <div class="instructions">
                <h2>Choose Test Type</h2>
                <p>You'll have <strong>60 seconds</strong> to name as many words as you can.</p>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="selectType('category')">Category</button>
                <button class="tab" onclick="selectType('letter')">Letter</button>
            </div>
            
            <div id="categoryInfo">
                <p style="text-align: center; margin-bottom: 1rem;">
                    Name as many <strong>animals</strong> as you can in 60 seconds.
                </p>
                <div style="text-align: center;">
                    <button class="btn secondary" onclick="setCategory('animals')">üêæ Animals</button>
                    <button class="btn secondary" onclick="setCategory('fruits')">üçé Fruits</button>
                    <button class="btn secondary" onclick="setCategory('countries')">üåç Countries</button>
                </div>
            </div>
            
            <div id="letterInfo" class="hidden">
                <p style="text-align: center; margin-bottom: 1rem;">
                    Name as many words starting with a letter as you can.
                </p>
                <div style="text-align: center;">
                    <button class="btn secondary" onclick="setLetter('F')">Letter F</button>
                    <button class="btn secondary" onclick="setLetter('A')">Letter A</button>
                    <button class="btn secondary" onclick="setLetter('S')">Letter S</button>
                </div>
            </div>
            
            <div id="selectedTest" style="margin-top: 1.5rem; text-align: center;">
                <p style="color: #888;">Selected: <span id="testDescription" style="color: #00d4aa;">Animals</span></p>
            </div>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <button class="btn" onclick="startTest()">Start Test</button>
            </div>
        </div>
        
        <!-- Game Area -->
        <div class="card hidden" id="gameCard">
            <div class="category-display" id="categoryDisplay">ANIMALS</div>
            
            <div class="timer-circle" style="--progress: 100%;">
                <div class="timer-inner">
                    <div class="timer-number" id="timerDisplay">60</div>
                    <div class="timer-label">seconds</div>
                </div>
            </div>
            
            <div class="word-count" id="wordCount">0</div>
            <div class="word-count-label">words entered</div>
            
            <div class="input-area">
                <input type="text" class="word-input" id="wordInput" 
                       placeholder="Type a word and press Enter"
                       autocomplete="off" autocapitalize="none">
            </div>
            
            <div class="feedback" id="feedback"></div>
            
            <div class="words-list" id="wordsList"></div>
        </div>
        
        <!-- Results -->
        <div class="card hidden" id="resultsCard">
            <h2 style="color: #C5A572; text-align: center; margin-bottom: 1rem;">üìä Results</h2>
            
            <div class="score-display">
                <div class="score-big" id="finalScore">0</div>
                <div class="score-label">valid words</div>
            </div>
            
            <p style="text-align: center; color: #888; margin: 1rem 0;">
                Test: <span id="resultTest" style="color: #C5A572;">Animals</span>
            </p>
            
            <div class="norms-info">
                <h4>üìã Reference Ranges</h4>
                <ul>
                    <li class="norm-good"><strong>15+ words:</strong> Normal/Good performance</li>
                    <li class="norm-avg"><strong>12-14 words:</strong> Low-normal range</li>
                    <li class="norm-concern"><strong>&lt;12 words:</strong> May warrant further evaluation</li>
                </ul>
                <p style="font-size: 0.8rem; color: #888; margin-top: 0.5rem;">
                    *Norms vary by age, education, and test type. Category (animals) typically yields more words than letter fluency.
                </p>
            </div>
            
            <div id="interpretation" class="interpretation"></div>
            
            <div class="words-list" id="resultWords" style="margin-top: 1rem;"></div>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <button class="btn" onclick="tryAgain()">üîÑ Try Again</button>
                <button class="btn secondary" onclick="window.print()">üñ®Ô∏è Print</button>
            </div>
        </div>
        
        <div class="history-section">
            <h3 class="history-title">üìà Previous Attempts</h3>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>
    
    <script>
        let testType = 'category';
        let testValue = 'animals';
        let words = [];
        let timeLeft = 60;
        let timerInterval = null;
        
        // Common animals for basic validation
        const animalsList = ['dog','cat','lion','tiger','elephant','bear','wolf','fox','deer','rabbit','mouse','rat','horse','cow','pig','sheep','goat','chicken','duck','turkey','eagle','hawk','owl','crow','sparrow','penguin','dolphin','whale','shark','fish','salmon','tuna','crab','lobster','shrimp','octopus','snake','lizard','turtle','frog','toad','alligator','crocodile','monkey','ape','gorilla','chimpanzee','giraffe','zebra','hippo','rhino','buffalo','moose','elk','camel','kangaroo','koala','panda','leopard','cheetah','jaguar','panther','cougar','lynx','bobcat','raccoon','skunk','beaver','otter','seal','walrus','bat','squirrel','chipmunk','hamster','guinea pig','parrot','flamingo','peacock','swan','goose','pigeon','seagull','pelican','heron','stork','vulture','condor','ostrich','emu','ant','bee','wasp','butterfly','moth','beetle','spider','scorpion','centipede','worm','snail','slug'];
        
        function selectType(type) {
            testType = type;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('categoryInfo').classList.toggle('hidden', type !== 'category');
            document.getElementById('letterInfo').classList.toggle('hidden', type !== 'letter');
            
            if (type === 'category') {
                setCategory('animals');
            } else {
                setLetter('F');
            }
        }
        
        function setCategory(cat) {
            testValue = cat;
            const labels = { animals: 'Animals', fruits: 'Fruits', countries: 'Countries' };
            document.getElementById('testDescription').textContent = labels[cat];
        }
        
        function setLetter(letter) {
            testValue = letter;
            document.getElementById('testDescription').textContent = `Words starting with "${letter}"`;
        }
        
        function startTest() {
            words = [];
            timeLeft = 60;
            
            document.getElementById('selectionCard').classList.add('hidden');
            document.getElementById('gameCard').classList.remove('hidden');
            
            const label = testType === 'category' ? testValue.toUpperCase() : `LETTER "${testValue}"`;
            document.getElementById('categoryDisplay').textContent = label;
            document.getElementById('wordCount').textContent = '0';
            document.getElementById('wordsList').innerHTML = '';
            document.getElementById('feedback').textContent = '';
            
            const input = document.getElementById('wordInput');
            input.value = '';
            input.disabled = false;
            input.focus();
            
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    submitWord();
                }
            };
            
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        function updateTimer() {
            timeLeft--;
            document.getElementById('timerDisplay').textContent = timeLeft;
            
            const progress = (timeLeft / 60) * 100;
            document.querySelector('.timer-circle').style.setProperty('--progress', progress + '%');
            
            if (timeLeft <= 10) {
                document.getElementById('timerDisplay').style.color = '#e74c3c';
            }
            
            if (timeLeft <= 0) {
                endTest();
            }
        }
        
        function submitWord() {
            const input = document.getElementById('wordInput');
            const word = input.value.trim().toLowerCase();
            input.value = '';
            
            if (!word) return;
            
            const feedback = document.getElementById('feedback');
            
            // Check for duplicates
            if (words.some(w => w.word === word)) {
                feedback.textContent = 'Already entered!';
                feedback.className = 'feedback error';
                addWordChip(word, 'duplicate');
                return;
            }
            
            // Validate based on test type
            let valid = true;
            if (testType === 'letter') {
                if (!word.startsWith(testValue.toLowerCase())) {
                    feedback.textContent = `Must start with "${testValue}"`;
                    feedback.className = 'feedback error';
                    addWordChip(word, 'invalid');
                    valid = false;
                }
            }
            
            if (valid) {
                words.push({ word, valid: true });
                feedback.textContent = '‚úì ' + word;
                feedback.className = 'feedback success';
                addWordChip(word, 'valid');
                document.getElementById('wordCount').textContent = words.length;
            }
            
            setTimeout(() => { feedback.textContent = ''; }, 1000);
        }
        
        function addWordChip(word, status) {
            const list = document.getElementById('wordsList');
            const chip = document.createElement('span');
            chip.className = 'word-chip';
            if (status === 'duplicate') chip.classList.add('duplicate');
            if (status === 'invalid') chip.classList.add('invalid');
            chip.textContent = word;
            list.insertBefore(chip, list.firstChild);
        }
        
        function endTest() {
            clearInterval(timerInterval);
            
            document.getElementById('wordInput').disabled = true;
            
            setTimeout(() => {
                document.getElementById('gameCard').classList.add('hidden');
                document.getElementById('resultsCard').classList.remove('hidden');
                
                const validWords = words.filter(w => w.valid);
                const count = validWords.length;
                
                document.getElementById('finalScore').textContent = count;
                document.getElementById('resultTest').textContent = 
                    testType === 'category' ? testValue.charAt(0).toUpperCase() + testValue.slice(1) : `Letter "${testValue}"`;
                
                // Show words
                document.getElementById('resultWords').innerHTML = validWords.map(w => 
                    `<span class="word-chip">${w.word}</span>`
                ).join('');
                
                // Interpretation
                const interp = document.getElementById('interpretation');
                if (count >= 15) {
                    interp.className = 'interpretation interp-good';
                    interp.innerHTML = '‚úÖ <strong>Good Performance!</strong><br>Your verbal fluency is within the normal range.';
                } else if (count >= 12) {
                    interp.className = 'interpretation interp-concern';
                    interp.innerHTML = '‚ö†Ô∏è <strong>Low-Normal Range</strong><br>Your performance is acceptable but on the lower end. Consider regular word games to exercise verbal skills.';
                } else {
                    interp.className = 'interpretation interp-alert';
                    interp.innerHTML = 'üî¥ <strong>Below Expected Range</strong><br>Consider discussing these results with a healthcare provider, especially if this differs from your usual ability.';
                }
                
                // Save history
                saveHistory(count, testType, testValue);
                displayHistory();
            }, 500);
        }
        
        function saveHistory(score, type, value) {
            const history = JSON.parse(localStorage.getItem('verbalFluencyHistory') || '[]');
            history.push({
                date: new Date().toISOString(),
                score: score,
                type: type,
                value: value
            });
            if (history.length > 20) history.shift();
            localStorage.setItem('verbalFluencyHistory', JSON.stringify(history));
        }
        
        function displayHistory() {
            const history = JSON.parse(localStorage.getItem('verbalFluencyHistory') || '[]');
            const list = document.getElementById('historyList');
            
            if (history.length === 0) {
                list.innerHTML = '<div style="padding: 1rem; text-align: center; color: #888;">No previous attempts</div>';
                return;
            }
            
            list.innerHTML = history.slice(-10).reverse().map(h => {
                const date = new Date(h.date).toLocaleDateString();
                const test = h.type === 'category' ? h.value : `Letter ${h.value}`;
                return `<div class="history-item">
                    <span style="color: #888;">${date} - ${test}</span>
                    <span style="color: #00d4aa; font-weight: bold;">${h.score} words</span>
                </div>`;
            }).join('');
        }
        
        function tryAgain() {
            document.getElementById('resultsCard').classList.add('hidden');
            document.getElementById('selectionCard').classList.remove('hidden');
            document.getElementById('timerDisplay').style.color = '#00d4aa';
        }
        
        // Initialize
        displayHistory();
    </script>
</body>
</html>
