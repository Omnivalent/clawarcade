<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cognitive Screening - ClawMD</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: linear-gradient(135deg, #1a2332 0%, #0f1419 100%); 
            color: #e8e6e3; 
            min-height: 100vh; 
            padding: 1rem;
        }
        .container { max-width: 700px; margin: 0 auto; }
        
        /* Header */
        .header { text-align: center; margin-bottom: 1.5rem; padding: 1rem; background: rgba(139, 0, 0, 0.2); border-radius: 12px; border: 2px solid #C5A572; }
        .header h1 { color: #C5A572; font-size: 1.8rem; margin-bottom: 0.5rem; }
        .header p { color: #aaa; font-size: 1rem; }
        
        /* Disclaimer */
        .disclaimer { 
            background: rgba(255, 193, 7, 0.15); 
            border: 2px solid #ffc107; 
            border-radius: 10px; 
            padding: 1rem; 
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .disclaimer strong { color: #ffc107; }
        
        /* Progress Bar */
        .progress-container { margin-bottom: 1.5rem; }
        .progress-bar { 
            height: 12px; 
            background: #2a3441; 
            border-radius: 6px; 
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #00d4aa, #00ff88); 
            transition: width 0.5s ease;
            border-radius: 6px;
        }
        .progress-text { color: #C5A572; font-size: 0.9rem; text-align: center; }
        
        /* Sections */
        .section { 
            background: rgba(0, 33, 71, 0.4); 
            border: 2px solid #C5A572; 
            border-radius: 12px; 
            padding: 1.5rem; 
            margin-bottom: 1rem;
            display: none;
        }
        .section.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .section h2 { color: #C5A572; font-size: 1.4rem; margin-bottom: 1rem; text-align: center; }
        .section p { font-size: 1.1rem; line-height: 1.6; margin-bottom: 1rem; text-align: center; }
        
        /* Questions */
        .question { margin-bottom: 1.5rem; }
        .question label { display: block; font-size: 1.2rem; margin-bottom: 0.75rem; color: #e8e6e3; }
        
        /* Buttons */
        .btn { 
            display: inline-block;
            background: linear-gradient(135deg, #8B0000 0%, #6B0000 100%); 
            color: #C5A572; 
            border: 2px solid #C5A572;
            padding: 1rem 2rem; 
            font-size: 1.1rem; 
            font-weight: 600;
            border-radius: 8px; 
            cursor: pointer; 
            min-height: 56px;
            min-width: 140px;
            transition: all 0.3s;
        }
        .btn:hover { background: linear-gradient(135deg, #A00000 0%, #8B0000 100%); transform: translateY(-2px); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-group { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem; }
        
        /* Options Grid */
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem; margin: 1rem 0; }
        .option-btn { 
            background: #1a2332; 
            border: 2px solid #C5A572; 
            color: #e8e6e3; 
            padding: 1rem; 
            font-size: 1.1rem; 
            border-radius: 8px; 
            cursor: pointer; 
            min-height: 56px;
            transition: all 0.2s;
        }
        .option-btn:hover { background: rgba(197, 165, 114, 0.2); }
        .option-btn.selected { background: #00d4aa; color: #1a1a2e; border-color: #00d4aa; }
        .option-btn.correct { background: #00d4aa; color: #1a1a2e; }
        .option-btn.incorrect { background: #e74c3c; color: white; }
        
        /* Input */
        .text-input { 
            width: 100%; 
            padding: 1rem; 
            font-size: 1.2rem; 
            border: 2px solid #C5A572; 
            border-radius: 8px; 
            background: #1a2332; 
            color: #e8e6e3;
            min-height: 56px;
        }
        .text-input:focus { outline: none; border-color: #00d4aa; }
        
        /* Score Display */
        .score-display { 
            text-align: center; 
            padding: 2rem; 
            background: rgba(0, 212, 170, 0.1); 
            border-radius: 12px; 
            margin: 1rem 0;
        }
        .score-big { font-size: 3rem; color: #00d4aa; font-weight: bold; }
        .score-label { font-size: 1.2rem; color: #C5A572; margin-top: 0.5rem; }
        .score-interpretation { 
            margin-top: 1rem; 
            padding: 1rem; 
            border-radius: 8px; 
            font-size: 1.1rem;
        }
        .score-normal { background: rgba(0, 212, 170, 0.2); border: 2px solid #00d4aa; }
        .score-mild { background: rgba(255, 193, 7, 0.2); border: 2px solid #ffc107; }
        .score-moderate { background: rgba(255, 152, 0, 0.2); border: 2px solid #ff9800; }
        .score-severe { background: rgba(244, 67, 54, 0.2); border: 2px solid #f44336; }
        
        /* Words Display */
        .words-display { 
            display: flex; 
            justify-content: center; 
            gap: 2rem; 
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        .word-card { 
            background: #00d4aa; 
            color: #1a1a2e; 
            padding: 1.5rem 2rem; 
            border-radius: 12px; 
            font-size: 1.5rem; 
            font-weight: bold;
            animation: popIn 0.5s ease;
        }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        
        /* Drawing Canvas */
        .canvas-container { 
            background: white; 
            border-radius: 12px; 
            padding: 1rem; 
            margin: 1rem 0;
            text-align: center;
        }
        #drawingCanvas { 
            border: 3px solid #333; 
            border-radius: 8px; 
            cursor: crosshair;
            touch-action: none;
            max-width: 100%;
        }
        .canvas-tools { 
            display: flex; 
            gap: 0.5rem; 
            justify-content: center; 
            margin-top: 0.75rem;
        }
        .tool-btn { 
            padding: 0.5rem 1rem; 
            background: #333; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer;
            min-height: 44px;
        }
        .tool-btn:hover { background: #555; }
        
        /* History */
        .history-section { margin-top: 2rem; }
        .history-title { color: #C5A572; font-size: 1.2rem; margin-bottom: 1rem; }
        .history-chart { 
            background: #1a2332; 
            border-radius: 8px; 
            padding: 1rem; 
            min-height: 150px;
        }
        .history-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 0.75rem; 
            border-bottom: 1px solid #2a3441;
        }
        .history-date { color: #888; }
        .history-score { color: #00d4aa; font-weight: bold; }
        
        /* Back Link */
        .back-link { 
            display: inline-block; 
            color: #C5A572; 
            text-decoration: none; 
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        .back-link:hover { text-decoration: underline; }
        
        /* Countdown */
        .countdown { font-size: 3rem; color: #00d4aa; text-align: center; margin: 2rem 0; }
        
        /* High Contrast Mode */
        .high-contrast { background: #000 !important; }
        .high-contrast .section { background: #000; border-color: #fff; }
        .high-contrast .header { background: #000; border-color: #fff; }
        .high-contrast h1, .high-contrast h2, .high-contrast p, .high-contrast label { color: #fff !important; }
        
        /* Print Styles */
        @media print {
            body { background: white; color: black; }
            .btn, .back-link, .progress-container { display: none; }
            .section { display: block !important; border: 1px solid #ccc; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../games.html" class="back-link">‚Üê Back to Games</a>
        
        <div class="header">
            <h1>üß† Cognitive Screening</h1>
            <p>Complete Mental Status Assessment</p>
            <button onclick="toggleContrast()" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer;">Toggle High Contrast</button>
        </div>
        
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Important Notice:</strong> This screening tool is for educational and informational purposes only. 
            It is NOT a medical diagnosis. Results should be discussed with a qualified healthcare provider. 
            If you have concerns about your cognitive health, please consult a doctor.
        </div>
        
        <div class="progress-container">
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
            <div class="progress-text" id="progressText">Section 1 of 6</div>
        </div>
        
        <!-- Section 0: Introduction -->
        <div class="section active" id="section-intro">
            <h2>Welcome!</h2>
            <p>This assessment takes about 10-15 minutes and covers several areas of cognitive function.</p>
            <p>Please find a quiet place and answer as best you can. There's no rush.</p>
            <div class="btn-group">
                <button class="btn" onclick="startAssessment()">Begin Assessment</button>
            </div>
        </div>
        
        <!-- Section 1: Orientation - Time -->
        <div class="section" id="section-orientation-time">
            <h2>üìÖ Part 1: Time Orientation</h2>
            <p>Please answer these questions about the current date and time.</p>
            
            <div class="question">
                <label>What year is it?</label>
                <div class="options-grid" id="yearOptions"></div>
            </div>
            
            <div class="question">
                <label>What season is it?</label>
                <div class="options-grid" id="seasonOptions"></div>
            </div>
            
            <div class="question">
                <label>What month is it?</label>
                <div class="options-grid" id="monthOptions"></div>
            </div>
            
            <div class="question">
                <label>What day of the week is it?</label>
                <div class="options-grid" id="dayOptions"></div>
            </div>
            
            <div class="question">
                <label>What is today's date (day of month)?</label>
                <div class="options-grid" id="dateOptions"></div>
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="nextSection('orientation-place')">Continue ‚Üí</button>
            </div>
        </div>
        
        <!-- Section 2: Orientation - Place -->
        <div class="section" id="section-orientation-place">
            <h2>üìç Part 2: Place Orientation</h2>
            <p>Please answer these questions about where you are.</p>
            
            <div class="question">
                <label>What country are you in?</label>
                <input type="text" class="text-input" id="countryInput" placeholder="Type your answer...">
            </div>
            
            <div class="question">
                <label>What state/region are you in?</label>
                <input type="text" class="text-input" id="stateInput" placeholder="Type your answer...">
            </div>
            
            <div class="question">
                <label>What city/town are you in?</label>
                <input type="text" class="text-input" id="cityInput" placeholder="Type your answer...">
            </div>
            
            <div class="question">
                <label>What type of building are you in? (home, office, hospital, etc.)</label>
                <input type="text" class="text-input" id="buildingInput" placeholder="Type your answer...">
            </div>
            
            <div class="question">
                <label>What floor are you on?</label>
                <input type="text" class="text-input" id="floorInput" placeholder="Type your answer...">
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="checkOrientationPlace()">Continue ‚Üí</button>
            </div>
        </div>
        
        <!-- Section 3: Registration -->
        <div class="section" id="section-registration">
            <h2>üìù Part 3: Word Memory</h2>
            <p>I'm going to show you three words. Please try to remember them.</p>
            
            <div id="registrationContent">
                <div class="words-display" id="wordsDisplay"></div>
                <p id="regInstructions">Study these words carefully...</p>
                <div class="countdown" id="regCountdown"></div>
            </div>
            
            <div id="registrationRecall" style="display: none;">
                <p>Now, please type the three words you just saw:</p>
                <div class="question">
                    <label>Word 1:</label>
                    <input type="text" class="text-input" id="regWord1" placeholder="Type the first word...">
                </div>
                <div class="question">
                    <label>Word 2:</label>
                    <input type="text" class="text-input" id="regWord2" placeholder="Type the second word...">
                </div>
                <div class="question">
                    <label>Word 3:</label>
                    <input type="text" class="text-input" id="regWord3" placeholder="Type the third word...">
                </div>
                <div class="btn-group">
                    <button class="btn" onclick="checkRegistration()">Continue ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- Section 4: Attention -->
        <div class="section" id="section-attention">
            <h2>üî¢ Part 4: Attention & Calculation</h2>
            <p>Starting at 100, subtract 7 and keep subtracting 7 from each answer.</p>
            <p style="color: #C5A572;">100 - 7 = ? then continue subtracting 7...</p>
            
            <div class="question">
                <label>100 - 7 = </label>
                <input type="number" class="text-input" id="serial1" placeholder="?">
            </div>
            <div class="question">
                <label>Then - 7 = </label>
                <input type="number" class="text-input" id="serial2" placeholder="?">
            </div>
            <div class="question">
                <label>Then - 7 = </label>
                <input type="number" class="text-input" id="serial3" placeholder="?">
            </div>
            <div class="question">
                <label>Then - 7 = </label>
                <input type="number" class="text-input" id="serial4" placeholder="?">
            </div>
            <div class="question">
                <label>Then - 7 = </label>
                <input type="number" class="text-input" id="serial5" placeholder="?">
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="checkAttention()">Continue ‚Üí</button>
            </div>
        </div>
        
        <!-- Section 5: Recall -->
        <div class="section" id="section-recall">
            <h2>üß† Part 5: Delayed Recall</h2>
            <p>Earlier, you were shown three words. Can you remember what they were?</p>
            
            <div class="question">
                <label>Word 1:</label>
                <input type="text" class="text-input" id="recallWord1" placeholder="Type the first word...">
            </div>
            <div class="question">
                <label>Word 2:</label>
                <input type="text" class="text-input" id="recallWord2" placeholder="Type the second word...">
            </div>
            <div class="question">
                <label>Word 3:</label>
                <input type="text" class="text-input" id="recallWord3" placeholder="Type the third word...">
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="checkRecall()">Continue ‚Üí</button>
            </div>
        </div>
        
        <!-- Section 6: Language -->
        <div class="section" id="section-language">
            <h2>üí¨ Part 6: Language</h2>
            
            <div class="question">
                <label>What is this object? üñäÔ∏è</label>
                <input type="text" class="text-input" id="naming1" placeholder="Type the name...">
            </div>
            
            <div class="question">
                <label>What is this object? ‚åö</label>
                <input type="text" class="text-input" id="naming2" placeholder="Type the name...">
            </div>
            
            <div class="question">
                <label>Please type exactly: "No ifs, ands, or buts"</label>
                <input type="text" class="text-input" id="repetition" placeholder="Type the phrase...">
            </div>
            
            <div class="question">
                <label>Write a complete sentence (any sentence you like):</label>
                <input type="text" class="text-input" id="sentence" placeholder="Write a sentence...">
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="checkLanguage()">Continue ‚Üí</button>
            </div>
        </div>
        
        <!-- Section 7: Drawing -->
        <div class="section" id="section-drawing">
            <h2>‚úèÔ∏è Part 7: Drawing</h2>
            <p>Please draw a clock face with all the numbers (1-12) and set the hands to show 10:10.</p>
            
            <div class="canvas-container">
                <canvas id="drawingCanvas" width="300" height="300"></canvas>
                <div class="canvas-tools">
                    <button class="tool-btn" onclick="clearCanvas()">Clear</button>
                    <button class="tool-btn" onclick="undoCanvas()">Undo</button>
                </div>
            </div>
            
            <p style="font-size: 0.9rem; color: #888;">Note: The clock drawing will be saved but requires human review for scoring.</p>
            
            <div class="btn-group">
                <button class="btn" onclick="finishAssessment()">Complete Assessment</button>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="section" id="section-results">
            <h2>üìä Your Results</h2>
            
            <div class="score-display">
                <div class="score-big" id="totalScore">0</div>
                <div class="score-label">out of 30 points</div>
            </div>
            
            <div class="score-interpretation" id="interpretation"></div>
            
            <div id="scoreBreakdown" style="margin-top: 1.5rem;">
                <h3 style="color: #C5A572; margin-bottom: 1rem;">Score Breakdown:</h3>
                <div id="breakdownList"></div>
            </div>
            
            <div class="disclaimer" style="margin-top: 1.5rem;">
                <strong>Remember:</strong> This is a screening tool, not a diagnosis. 
                Please share these results with your healthcare provider for proper evaluation.
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="printResults()">üñ®Ô∏è Print Results</button>
                <button class="btn" onclick="startOver()">üîÑ Start Over</button>
            </div>
            
            <div class="history-section">
                <h3 class="history-title">üìà Your History</h3>
                <div class="history-chart" id="historyChart"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Assessment State
        let scores = {
            orientationTime: 0,
            orientationPlace: 0,
            registration: 0,
            attention: 0,
            recall: 0,
            language: 0,
            drawing: 0 // Requires human review
        };
        
        const memoryWords = ['APPLE', 'TABLE', 'PENNY'];
        let currentSection = 'intro';
        let canvasHistory = [];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupOrientationQuestions();
            setupCanvas();
        });
        
        function setupOrientationQuestions() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            const currentDay = now.getDay();
            const currentDate = now.getDate();
            
            // Year options
            const years = [currentYear - 2, currentYear - 1, currentYear, currentYear + 1];
            shuffleArray(years);
            document.getElementById('yearOptions').innerHTML = years.map(y => 
                `<button class="option-btn" onclick="selectOption(this, 'year', ${y === currentYear})">${y}</button>`
            ).join('');
            
            // Season options
            const seasons = ['Spring', 'Summer', 'Fall/Autumn', 'Winter'];
            const currentSeason = getSeason(currentMonth);
            document.getElementById('seasonOptions').innerHTML = seasons.map(s => 
                `<button class="option-btn" onclick="selectOption(this, 'season', ${s.includes(currentSeason)})">${s}</button>`
            ).join('');
            
            // Month options
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                           'July', 'August', 'September', 'October', 'November', 'December'];
            const currentMonthName = months[currentMonth];
            const monthOptions = getRandomMonths(months, currentMonth);
            document.getElementById('monthOptions').innerHTML = monthOptions.map(m => 
                `<button class="option-btn" onclick="selectOption(this, 'month', ${m === currentMonthName})">${m}</button>`
            ).join('');
            
            // Day of week options
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const currentDayName = days[currentDay];
            document.getElementById('dayOptions').innerHTML = days.map(d => 
                `<button class="option-btn" onclick="selectOption(this, 'day', ${d === currentDayName})">${d}</button>`
            ).join('');
            
            // Date options
            const dateOptions = getRandomDates(currentDate);
            document.getElementById('dateOptions').innerHTML = dateOptions.map(d => 
                `<button class="option-btn" onclick="selectOption(this, 'date', ${d === currentDate})">${d}</button>`
            ).join('');
        }
        
        function getSeason(month) {
            if (month >= 2 && month <= 4) return 'Spring';
            if (month >= 5 && month <= 7) return 'Summer';
            if (month >= 8 && month <= 10) return 'Fall';
            return 'Winter';
        }
        
        function getRandomMonths(allMonths, currentIndex) {
            let options = [allMonths[currentIndex]];
            while (options.length < 4) {
                let randIndex = Math.floor(Math.random() * 12);
                if (!options.includes(allMonths[randIndex])) {
                    options.push(allMonths[randIndex]);
                }
            }
            shuffleArray(options);
            return options;
        }
        
        function getRandomDates(currentDate) {
            let options = [currentDate];
            while (options.length < 4) {
                let randDate = Math.floor(Math.random() * 28) + 1;
                if (!options.includes(randDate)) {
                    options.push(randDate);
                }
            }
            shuffleArray(options);
            return options;
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function selectOption(btn, category, isCorrect) {
            const parent = btn.parentElement;
            parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            btn.dataset.correct = isCorrect;
        }
        
        function startAssessment() {
            showSection('orientation-time');
            updateProgress(1);
        }
        
        function showSection(name) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + name).classList.add('active');
            currentSection = name;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            if (name === 'registration') {
                startRegistration();
            }
        }
        
        function nextSection(name) {
            // Score current section first
            if (currentSection === 'orientation-time') {
                scoreOrientationTime();
            }
            showSection(name);
            updateProgress(getSectionNumber(name));
        }
        
        function getSectionNumber(name) {
            const sections = ['intro', 'orientation-time', 'orientation-place', 'registration', 'attention', 'recall', 'language', 'drawing', 'results'];
            return sections.indexOf(name);
        }
        
        function updateProgress(step) {
            const percent = Math.min((step / 7) * 100, 100);
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = `Section ${step} of 7`;
        }
        
        function scoreOrientationTime() {
            let score = 0;
            ['yearOptions', 'seasonOptions', 'monthOptions', 'dayOptions', 'dateOptions'].forEach(id => {
                const selected = document.getElementById(id).querySelector('.selected');
                if (selected && selected.dataset.correct === 'true') score++;
            });
            scores.orientationTime = score;
        }
        
        function checkOrientationPlace() {
            // For place orientation, we accept any non-empty answer (can't verify location)
            let score = 0;
            ['countryInput', 'stateInput', 'cityInput', 'buildingInput', 'floorInput'].forEach(id => {
                if (document.getElementById(id).value.trim().length > 0) score++;
            });
            scores.orientationPlace = score;
            showSection('registration');
            updateProgress(3);
        }
        
        function startRegistration() {
            const display = document.getElementById('wordsDisplay');
            display.innerHTML = memoryWords.map(w => `<div class="word-card">${w}</div>`).join('');
            
            let countdown = 5;
            const countdownEl = document.getElementById('regCountdown');
            countdownEl.textContent = countdown;
            
            const timer = setInterval(() => {
                countdown--;
                countdownEl.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(timer);
                    document.getElementById('registrationContent').style.display = 'none';
                    document.getElementById('registrationRecall').style.display = 'block';
                }
            }, 1000);
        }
        
        function checkRegistration() {
            let score = 0;
            const answers = [
                document.getElementById('regWord1').value.trim().toUpperCase(),
                document.getElementById('regWord2').value.trim().toUpperCase(),
                document.getElementById('regWord3').value.trim().toUpperCase()
            ];
            
            memoryWords.forEach(word => {
                if (answers.includes(word)) score++;
            });
            
            scores.registration = score;
            showSection('attention');
            updateProgress(4);
        }
        
        function checkAttention() {
            const correct = [93, 86, 79, 72, 65];
            let score = 0;
            
            for (let i = 0; i < 5; i++) {
                const answer = parseInt(document.getElementById('serial' + (i + 1)).value);
                if (answer === correct[i]) score++;
            }
            
            scores.attention = score;
            showSection('recall');
            updateProgress(5);
        }
        
        function checkRecall() {
            let score = 0;
            const answers = [
                document.getElementById('recallWord1').value.trim().toUpperCase(),
                document.getElementById('recallWord2').value.trim().toUpperCase(),
                document.getElementById('recallWord3').value.trim().toUpperCase()
            ];
            
            memoryWords.forEach(word => {
                if (answers.includes(word)) score++;
            });
            
            scores.recall = score;
            showSection('language');
            updateProgress(6);
        }
        
        function checkLanguage() {
            let score = 0;
            
            // Naming (2 points)
            const pen = document.getElementById('naming1').value.trim().toLowerCase();
            if (pen.includes('pen') || pen.includes('pencil')) score++;
            
            const watch = document.getElementById('naming2').value.trim().toLowerCase();
            if (watch.includes('watch') || watch.includes('clock')) score++;
            
            // Repetition (1 point)
            const rep = document.getElementById('repetition').value.trim().toLowerCase().replace(/[^a-z\s]/g, '');
            if (rep.includes('no ifs') && rep.includes('ands') && rep.includes('buts')) score++;
            
            // Sentence (1 point - any valid sentence)
            const sentence = document.getElementById('sentence').value.trim();
            if (sentence.length > 5 && sentence.includes(' ')) score++;
            
            scores.language = score;
            showSection('drawing');
            updateProgress(7);
        }
        
        // Canvas Setup
        function setupCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Draw circle guide
            ctx.beginPath();
            ctx.arc(150, 150, 130, 0, Math.PI * 2);
            ctx.stroke();
            
            function getPos(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                if (e.touches) {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                }
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }
            
            function startDraw(e) {
                isDrawing = true;
                const pos = getPos(e);
                lastX = pos.x;
                lastY = pos.y;
                canvasHistory.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
            }
            
            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                const pos = getPos(e);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                lastX = pos.x;
                lastY = pos.y;
            }
            
            function stopDraw() {
                isDrawing = false;
            }
            
            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDraw);
            canvas.addEventListener('mouseout', stopDraw);
            
            canvas.addEventListener('touchstart', startDraw);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDraw);
        }
        
        function clearCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            canvasHistory.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.arc(150, 150, 130, 0, Math.PI * 2);
            ctx.stroke();
        }
        
        function undoCanvas() {
            if (canvasHistory.length > 0) {
                const canvas = document.getElementById('drawingCanvas');
                const ctx = canvas.getContext('2d');
                ctx.putImageData(canvasHistory.pop(), 0, 0);
            }
        }
        
        function finishAssessment() {
            // Save drawing
            const canvas = document.getElementById('drawingCanvas');
            const drawingData = canvas.toDataURL('image/png');
            
            // Calculate total score
            const total = scores.orientationTime + scores.orientationPlace + 
                         scores.registration + scores.attention + 
                         scores.recall + scores.language;
            
            // Show results
            document.getElementById('totalScore').textContent = total;
            
            // Interpretation
            let interpEl = document.getElementById('interpretation');
            let interpClass = '';
            let interpText = '';
            
            if (total >= 24) {
                interpClass = 'score-normal';
                interpText = '‚úÖ <strong>Normal Range</strong><br>Your cognitive screening results are within the normal range. Keep exercising your mind with our other brain games!';
            } else if (total >= 18) {
                interpClass = 'score-mild';
                interpText = '‚ö†Ô∏è <strong>Mild Concern</strong><br>Some areas may benefit from attention. Consider discussing these results with your healthcare provider.';
            } else if (total >= 10) {
                interpClass = 'score-moderate';
                interpText = '‚ö†Ô∏è <strong>Moderate Concern</strong><br>We recommend discussing these results with a healthcare provider for a comprehensive evaluation.';
            } else {
                interpClass = 'score-severe';
                interpText = 'üî¥ <strong>Please Seek Evaluation</strong><br>These results suggest a comprehensive cognitive evaluation with a healthcare provider would be beneficial.';
            }
            
            interpEl.className = 'score-interpretation ' + interpClass;
            interpEl.innerHTML = interpText;
            
            // Breakdown
            const breakdown = document.getElementById('breakdownList');
            breakdown.innerHTML = `
                <div class="history-item"><span>Time Orientation</span><span class="history-score">${scores.orientationTime}/5</span></div>
                <div class="history-item"><span>Place Orientation</span><span class="history-score">${scores.orientationPlace}/5</span></div>
                <div class="history-item"><span>Registration</span><span class="history-score">${scores.registration}/3</span></div>
                <div class="history-item"><span>Attention/Calculation</span><span class="history-score">${scores.attention}/5</span></div>
                <div class="history-item"><span>Delayed Recall</span><span class="history-score">${scores.recall}/3</span></div>
                <div class="history-item"><span>Language</span><span class="history-score">${scores.language}/4</span></div>
                <div class="history-item"><span>Clock Drawing</span><span class="history-score">Review Needed</span></div>
            `;
            
            // Save to history
            saveToHistory(total, drawingData);
            displayHistory();
            
            showSection('results');
            updateProgress(8);
        }
        
        function saveToHistory(score, drawing) {
            const history = JSON.parse(localStorage.getItem('cognitiveScreeningHistory') || '[]');
            history.push({
                date: new Date().toISOString(),
                score: score,
                scores: {...scores},
                drawing: drawing
            });
            // Keep last 20 entries
            if (history.length > 20) history.shift();
            localStorage.setItem('cognitiveScreeningHistory', JSON.stringify(history));
        }
        
        function displayHistory() {
            const history = JSON.parse(localStorage.getItem('cognitiveScreeningHistory') || '[]');
            const chart = document.getElementById('historyChart');
            
            if (history.length === 0) {
                chart.innerHTML = '<p style="text-align: center; color: #888;">No previous assessments</p>';
                return;
            }
            
            chart.innerHTML = history.slice(-10).reverse().map(h => {
                const date = new Date(h.date).toLocaleDateString();
                return `<div class="history-item"><span class="history-date">${date}</span><span class="history-score">${h.score}/30</span></div>`;
            }).join('');
        }
        
        function printResults() {
            window.print();
        }
        
        function startOver() {
            scores = {
                orientationTime: 0,
                orientationPlace: 0,
                registration: 0,
                attention: 0,
                recall: 0,
                language: 0,
                drawing: 0
            };
            
            // Clear inputs
            document.querySelectorAll('.text-input').forEach(i => i.value = '');
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            
            // Reset registration display
            document.getElementById('registrationContent').style.display = 'block';
            document.getElementById('registrationRecall').style.display = 'none';
            
            // Clear canvas
            clearCanvas();
            canvasHistory = [];
            
            showSection('intro');
            updateProgress(0);
        }
        
        function toggleContrast() {
            document.body.classList.toggle('high-contrast');
        }
    </script>
</body>
</html>
