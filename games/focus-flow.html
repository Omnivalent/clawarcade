<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; font-src https://fonts.gstatic.com data:; img-src 'self' data: blob:; connect-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="referrer" content="no-referrer">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Focus Flow</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#1a1a2e;color:#e0e0e0;font-family:'Segoe UI',system-ui,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100dvh;overflow:hidden;touch-action:none;user-select:none}
h1{font-size:1.3rem;color:#00d4aa;margin-bottom:4px}
#hud{font-size:.9rem;color:#8888aa;margin-bottom:6px}
#hud span{color:#00d4aa}
canvas{border-radius:12px;background:#16213e}
#msg{font-size:1rem;color:#00d4aa;margin-top:8px;min-height:1.4em}
.btn{background:#00d4aa;color:#1a1a2e;border:none;padding:12px 28px;border-radius:8px;font-size:1rem;font-weight:700;cursor:pointer;min-height:44px;margin-top:10px}
.btn:active{transform:scale(.95)}
</style>
</head>
<body>
<h1>Focus Flow</h1>
<div id="hud">Score: <span id="score">0</span> | Accuracy: <span id="acc">100%</span> | Time: <span id="time">30</span>s</div>
<canvas id="c"></canvas>
<div id="msg">Touch and follow the dot</div>
<button class="btn" id="startBtn" onclick="startGame()">Start</button>
<script>
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d'),scoreEl=document.getElementById('score'),accEl=document.getElementById('acc'),timeEl=document.getElementById('time'),msgEl=document.getElementById('msg'),startBtn=document.getElementById('startBtn');
let W,H,dotX,dotY,dotR=18,fingerX=-1,fingerY=-1,running=false,score=0,samples=0,totalDist=0,gameTime=30,timer,elapsed=0;
let dotAngle=0,dotSpeed=0.02,dotCX,dotCY,dotRad,trail=[];

function resize(){
  const s=Math.min(window.innerWidth-20,window.innerHeight-160,400);
  W=H=s;canvas.width=W;canvas.height=H;dotCX=W/2;dotCY=H/2;dotRad=W*0.3;
}
resize();window.addEventListener('resize',resize);

function moveDot(){
  dotAngle+=dotSpeed;
  // Lissajous pattern
  dotX=dotCX+Math.sin(dotAngle*1.3)*dotRad;
  dotY=dotCY+Math.cos(dotAngle)*dotRad*0.8;
}

function getPos(e){
  const r=canvas.getBoundingClientRect();
  const t=e.touches?e.touches[0]:e;
  return[t.clientX-r.left,t.clientY-r.top];
}

canvas.addEventListener('touchmove',e=>{e.preventDefault();[fingerX,fingerY]=getPos(e)},{passive:false});
canvas.addEventListener('touchstart',e=>{e.preventDefault();[fingerX,fingerY]=getPos(e)},{passive:false});
canvas.addEventListener('touchend',()=>{fingerX=fingerY=-1});
canvas.addEventListener('mousemove',e=>{if(e.buttons)[fingerX,fingerY]=getPos(e)});
canvas.addEventListener('mousedown',e=>{[fingerX,fingerY]=getPos(e)});
canvas.addEventListener('mouseup',()=>{fingerX=fingerY=-1});

function startGame(){
  running=true;score=0;samples=0;totalDist=0;elapsed=0;dotAngle=0;dotSpeed=0.02;trail=[];
  startBtn.style.display='none';msgEl.textContent='';
  timer=setInterval(()=>{elapsed++;timeEl.textContent=gameTime-elapsed;
    dotSpeed=0.02+elapsed*0.001; // speed up
    if(elapsed>=gameTime)endGame()},1000);
  animate();
}
function endGame(){
  running=false;clearInterval(timer);
  const avgAcc=samples>0?Math.max(0,100-totalDist/samples):0;
  msgEl.textContent=`Game Over! Score: ${score} | Avg Accuracy: ${Math.round(avgAcc)}%`;
  startBtn.style.display='inline-block';startBtn.textContent='Play Again';
}
function animate(){
  if(!running)return;
  moveDot();
  trail.push({x:dotX,y:dotY,a:1});
  if(trail.length>20)trail.shift();
  
  // Score
  if(fingerX>=0){
    const d=Math.hypot(fingerX-dotX,fingerY-dotY);
    samples++;totalDist+=Math.min(d,100);
    if(d<dotR*2.5)score+=Math.max(1,Math.round((1-d/(dotR*2.5))*10));
  }
  scoreEl.textContent=score;
  const avgAcc=samples>0?Math.max(0,100-totalDist/samples):100;
  accEl.textContent=Math.round(avgAcc)+'%';

  // Draw
  ctx.clearRect(0,0,W,H);
  // Trail
  trail.forEach((t,i)=>{
    const a=i/trail.length*0.3;
    ctx.fillStyle=`rgba(0,212,170,${a})`;ctx.beginPath();ctx.arc(t.x,t.y,dotR*0.6,0,Math.PI*2);ctx.fill();
  });
  // Connection line
  if(fingerX>=0){
    const d=Math.hypot(fingerX-dotX,fingerY-dotY);
    const col=d<dotR*2?'#00d4aa':d<dotR*4?'#f1c40f':'#e74c3c';
    ctx.strokeStyle=col+'88';ctx.lineWidth=2;ctx.setLineDash([4,4]);
    ctx.beginPath();ctx.moveTo(fingerX,fingerY);ctx.lineTo(dotX,dotY);ctx.stroke();ctx.setLineDash([]);
    // Finger
    ctx.fillStyle=col+'66';ctx.beginPath();ctx.arc(fingerX,fingerY,16,0,Math.PI*2);ctx.fill();
  }
  // Dot
  const glow=ctx.createRadialGradient(dotX,dotY,0,dotX,dotY,dotR*2);
  glow.addColorStop(0,'#00d4aa');glow.addColorStop(1,'transparent');
  ctx.fillStyle=glow;ctx.beginPath();ctx.arc(dotX,dotY,dotR*2,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#00d4aa';ctx.beginPath();ctx.arc(dotX,dotY,dotR,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(dotX-4,dotY-4,4,0,Math.PI*2);ctx.fill();

  requestAnimationFrame(animate);
}
</script>
</body>
</html>
